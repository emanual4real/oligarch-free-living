{{ this.currentBreakpoint }}
<h1>Know your enemy</h1>

<div class="card">
  <p-table
    [columns]="cols"
    [value]="(data$ | async) ?? []"
    dataKey="_id"
    [tableStyle]="{ 'min-width': '60rem' }"
    [expandedRowKeys]="expandedRows"
  >
    <ng-template #caption>
      <div class="flex flex-wrap justify-end gap-2">
        <p-button label="Expand All" icon="pi pi-plus" text (onClick)="expandAll()" />
        <p-button label="Collapse All" icon="pi pi-minus" text (onClick)="collapseAll()" />
      </div>
    </ng-template>
    <ng-template #header let-columns>
      <tr>
        <th style="width: 5rem"></th>
        @for (col of columns; track $index) {
          @if (!col.breakpoint) {
            <th [pSortableColumn]="col.field">
              {{ col.header }}
              @if (col.sort) {
                <p-sortIcon [field]="col.field" />
              }
            </th>
          } @else if (col.breakpoint && col.breakpoint.includes(currentBreakpoint)) {
            <th [pSortableColumn]="col.field">
              {{ col.header }}
              @if (col.sort) {
                <p-sortIcon [field]="col.field" />
              }
            </th>
          }
        }
      </tr>
    </ng-template>
    <ng-template #body let-data let-columns="columns" let-expanded="expanded">
      <tr>
        <td>
          <p-button
            type="button"
            pRipple
            [pRowToggler]="data"
            [text]="true"
            [rounded]="true"
            [plain]="true"
            [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"
          />
        </td>
        @for (col of columns; track $index) {
          @if (col.type === 'array') {}

          <td>{{ data[col.field] }}</td>
        }

        <td>
          <ul>
            @for (company of data.companies; track $index) {
              <li>
                <a [routerLink]="['/companies']" [fragment]="company._id">
                  {{ company.companyName }}
                </a>
              </li>
            }
          </ul>
        </td>
        <!-- <td>{{ data.oligarchRating }}</td> -->
        @if (currentBreakpoint !== Breakpoints.XSmall) {
          <td>{{ data.description }}</td>
        }
      </tr>
    </ng-template>
    <ng-template #expandedrow let-oligarch>
      <tr>
        @if (currentBreakpoint === Breakpoints.XSmall) {
          <td>{{ oligarch.description }}</td>
        }
        <td colspan="7">
          <div class="p-4">
            <ul>
              @for (source of oligarch.sources; track $index) {
                <li>
                  <a [href]="source" target="_blank">{{ source }}</a>
                </li>
              }
            </ul>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
